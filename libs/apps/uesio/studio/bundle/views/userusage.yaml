name: userusage
definition:
  # Wires are how we pull in data
  wires:
    usage:
      collection: uesio/studio.usage
      fields:
        uesio/studio.app:
        uesio/studio.user:
        uesio/studio.day:
        uesio/studio.metadataname:
        uesio/studio.metadatatype:
        uesio/studio.site:
        uesio/studio.total:
        uesio/studio.actiontype:
      conditions:
        - field: uesio/studio.app->uesio/studio.user->uesio/core.id
          valueSource: VALUE
          value: $User{id}
        - field: uesio/studio.day
          operator: IN
          value: THIS_MONTH
    plans:
      collection: uesio/studio.usage_plan
      fields:
        uesio/studio.name:
    user_selected_plan:
      collection: uesio/studio.usage_plan_user
      fields:
        uesio/studio.user:
        uesio/studio.plan:
    limit_plan:
      collection: uesio/studio.usage_plan_limit
      fields:
        uesio/studio.plan:
          fields:
            uesio/core.id:
        uesio/studio.limit:
        uesio/studio.actiontype:
        uesio/studio.metadatatype:
  # Components are how we describe the layout of our view
  components:
    - uesio/io.viewlayout:
        uesio.variant: uesio/studio.main
        left:
          - uesio/core.view:
              view: userprofilenav
              uesio.context:
                wire: users
              params:
                selected: usage
        content:
          - uesio/io.titlebar:
              uesio.variant: uesio/io.main
              title: Usage & Billing
          - uesio/io.box:
              uesio.variant: uesio/io.section
              components:
                - uesio/io.titlebar:
                    uesio.variant: uesio/io.section
                    title: Plans
                - uesio/io.deck:
                    uesio.styleTokens:
                      root:
                        - grid
                        - gap-10
                        - grid-cols-1
                        - md:grid-cols-2
                        - lg:grid-cols-3
                        - xl:grid-cols-4
                    wire: plans
                    mode: READ
                    components:
                      - uesio/io.card:
                          scrollpanelVariant: uesio/io.card
                          title: ${uesio/studio.name}
                          content:
                            - uesio/io.list:
                                wire: limit_plan
                                recordDisplay:
                                  - type: fieldValue
                                    operator: EQUALS
                                    value: ${plans:uesio/core.id}
                                    field: uesio/studio.plan->uesio/core.id
                                components:
                                  - uesio/io.tile:
                                      uesio.variant: uesio/io.item
                                      content:
                                        - uesio/io.text:
                                            text: ${uesio/studio.limit} - ${uesio/studio.metadatatype} - ${uesio/studio.actiontype}
                          footer:
                            - uesio/io.button:
                                uesio.variant: uesio/io.primary
                                text: Upgrade to ${name}
                                signals:
                                  - signal: notification/ADD
                                    text: Coming soon!
                                    severity: success
                                uesio.display:
                                  - type: fieldValue
                                    operator: NOT_EQUALS
                                    value: ${uesio/core.id}
                                    wire: user_selected_plan
                                    field: uesio/studio.plan->uesio/core.id
                            - uesio/io.iconlabel:
                                uesio.variant: uesio/io.namespacefield
                                text: (Active Plan)
                                icon: check_circle
                                color: green
                                tooltip: Active plan for this user.
                                uesio.display:
                                  - type: fieldValue
                                    operator: EQUALS
                                    value: ${uesio/core.id}
                                    wire: user_selected_plan
                                    field: uesio/studio.plan->uesio/core.id
          - uesio/io.box:
              uesio.variant: uesio/io.section
              components:
                - uesio/io.titlebar:
                    uesio.variant: uesio/io.section
                    title: Current month usage
                - uesio/io.list:
                    wire: limit_plan
                    recordDisplay:
                      - type: fieldValue
                        operator: EQUALS
                        value: ${plans:uesio/core.id}
                        field: uesio/studio.plan->uesio/core.id
                    components:
                      - uesio/studio.limit:
                          title: ${uesio/studio.metadatatype}
                          subtitle: ${uesio/studio.actiontype}
                          wire: usage
                          maximum: ${uesio/studio.limit}
                          recordDisplay:
                            - field: uesio/studio.actiontype
                              type: fieldValue
                              value: ${limit_plan:uesio/studio.actiontype}
                            - field: uesio/studio.metadatatype
                              type: fieldValue
                              value: ${limit_plan:uesio/studio.metadatatype}
