name: apppublish
definition:
  # Wires are how we pull in data
  wires:
    apps:
      collection: uesio/studio.app
      fields:
        uesio/core.id:
        uesio/studio.fullname:
        uesio/studio.name:
        uesio/studio.description:
        uesio/studio.color:
        uesio/studio.user:
        uesio/studio.public:
        uesio/studio.icon:
        uesio/core.updatedby:
        uesio/core.updatedat:
        uesio/core.createdby:
        uesio/core.createdat:
        uesio/core.owner:
      conditions:
        - field: uesio/core.uniquekey
          valueSource: PARAM
          param: app
      requirewriteaccess: true
    bundlelisting:
      collection: uesio/studio.bundlelisting
      fields:
        uesio/core.id:
        uesio/studio.description:
        uesio/studio.app:
          fields:
            uesio/studio.color:
            uesio/studio.icon:
            uesio/studio.fullname:
        uesio/studio.status:
        uesio/studio.approved:
        uesio/core.owner:
        uesio/core.createdat:
        uesio/core.createdby:
        uesio/core.updatedat:
        uesio/core.updatedby:
      conditions:
        - field: uesio/studio.app
          valueSource: LOOKUP
          lookupWire: apps
          lookupField: uesio/core.id
      events:
        - type: onChange
          fields:
            - uesio/studio.status
          conditions:
            - type: hasValue
              value: "${uesio/studio.status}"
          signals:
            - signal: wire/UPDATE_RECORD
              wire: newbundlelistinghistory
              field: uesio/studio.actiontype
              valueSource: VALUE
              value: "${uesio/studio.status}"
    bundlelistinghistory:
      collection: uesio/studio.bundlelistinghistory
      fields:
        uesio/core.id:
        uesio/studio.app:
          fields:
            uesio/studio.color:
            uesio/studio.icon:
            uesio/studio.fullname:
        uesio/studio.actiontype:
        uesio/studio.comment:
        uesio/core.owner:
        uesio/core.createdat:
        uesio/core.createdby:
        uesio/core.updatedat:
        uesio/core.updatedby:
      conditions:
        - field: uesio/studio.app
          valueSource: LOOKUP
          lookupWire: apps
          lookupField: uesio/core.id
      order:
        - field: uesio/core.createdat
          desc: true
    newbundlelisting:
      collection: uesio/studio.bundlelisting
      fields:
        uesio/studio.description:
        uesio/studio.app:
        uesio/studio.status:
      init:
        query: false
        create: true
      defaults:
        - field: uesio/studio.app
          valueSource: LOOKUP
          lookupWire: apps
          lookupField: uesio/core.id
        - field: uesio/studio.description
          valueSource: LOOKUP
          lookupWire: apps
          lookupField: uesio/studio.description
        - field: uesio/studio.status
          valueSource: VALUE
          value: OPEN
    newbundlelistinghistory:
      collection: uesio/studio.bundlelistinghistory
      fields:
        uesio/studio.comment:
      init:
        query: false
        create: true
      defaults:
        - field: uesio/studio.app
          valueSource: LOOKUP
          lookupWire: apps
          lookupField: uesio/core.id
  # Components are how we describe the layout of our view
  components:
    - uesio/io.grid:
        uesio.variant: uesio/studio.mainlayout
        items:
          - uesio/io.griditem:
              uesio.variant: uesio/studio.topbar
              components:
                - uesio/core.view:
                    view: uesio/studio.topbar
                    uesio.context:
                      wire: apps
          - uesio/io.griditem:
              uesio.variant: uesio/studio.leftbar
              components:
                - uesio/core.view:
                    uesio.display:
                      - type: wireHasRecords
                        wire: apps
                    uesio.id: appnavview
                    view: uesio/studio.appnav
                    uesio.context:
                      wire: apps
                    params:
                      app: $Param{app}
                      selected: publish
          - uesio/io.griditem:
              uesio.variant: uesio/studio.content
              components:
                - uesio/io.list:
                    uesio.display:
                      - type: wireHasNoRecords
                        wire: bundlelisting
                    uesio.id: bundleListingDeck
                    wire: apps
                    mode: READ
                    components:
                      - uesio/io.titlebar:
                          uesio.variant: uesio/io.main
                          title: Publish App
                          subtitle: ${uesio/core.uniquekey}
                      - uesio/io.box:
                          uesio.variant: uesio/io.section
                          components:
                            - uesio/io.grid:
                                uesio.variant: uesio/io.two_columns
                                items:
                                  - uesio/io.box:
                                      components:
                                        - uesio/io.titlebar:
                                            uesio.variant: uesio/io.main
                                            title: Welcome! Now that you have your application $Param{app} ready, it's time to share it with the world!
                                            subtitle: please click the button below.
                                        - uesio/io.button:
                                            uesio.variant: uesio/io.primary
                                            text: Start
                                            signals:
                                              - signal: panel/TOGGLE
                                                panel: newBundleListing
                                  - uesio/io.box:
                                      components:
                                        - uesio/io.tile:
                                            uesio.styleTokens:
                                              root:
                                                - rounded-lg
                                                - overflow-hidden
                                                - bg-white
                                                - shadow-lg
                                                - max-h-80
                                                - max-w-md
                                            content:
                                              - uesio/io.box:
                                                  uesio.variant: uesio/studio.bundlelistingvisual
                                              - uesio/io.box:
                                                  uesio.styleTokens:
                                                    root:
                                                      - p-8
                                                  components:
                                                    - uesio/io.text:
                                                        text: ${uesio/studio.fullname}
                                                        element: span
                                                        uesio.styleTokens:
                                                          root:
                                                            - align-middle
                                                    - uesio/io.text:
                                                        uesio.variant: uesio/io.aside
                                                        text: ${uesio/studio.description}
                                                        element: p
                - uesio/io.list:
                    uesio.display:
                      - type: wireHasRecords
                        wire: bundlelisting
                    uesio.id: bundleListingDeck
                    wire: bundlelisting
                    mode: READ
                    components:
                      - uesio/io.titlebar:
                          uesio.variant: uesio/io.main
                          title: Publish App
                          subtitle: ${uesio/core.uniquekey}
                          actions:
                            - uesio/io.group:
                                components:
                                  - uesio/io.button:
                                      uesio.variant: uesio/io.primary
                                      text: Send for Review
                                      signals:
                                        - signal: wire/UPDATE_RECORD
                                          wire: bundlelisting
                                          field: uesio/studio.status
                                          valueSource: VALUE
                                          value: SUBMITTED
                                        - signal: panel/TOGGLE
                                          panel: feedbackPanel
                                      uesio.display:
                                        - field: uesio/studio.status
                                          value: OPEN
                                  - uesio/io.button:
                                      uesio.variant: uesio/io.primary
                                      text: Publish
                                      signals:
                                        - signal: wire/UPDATE_RECORD
                                          wire: bundlelisting
                                          field: uesio/studio.status
                                          valueSource: VALUE
                                          value: PUBLISHED
                                        - signal: panel/TOGGLE
                                          panel: feedbackPanel
                                      uesio.display:
                                        - field: uesio/studio.status
                                          value: APPROVED
                      - uesio/io.box:
                          uesio.variant: uesio/io.section
                          components:
                            - uesio/io.grid:
                                uesio.variant: uesio/io.two_columns
                                items:
                                  - uesio/io.box:
                                      components:
                                        - uesio/io.field:
                                            fieldId: uesio/studio.description
                                        - uesio/io.field:
                                            fieldId: uesio/studio.status
                                        - uesio/io.field:
                                            fieldId: uesio/studio.approved
                                  - uesio/io.box:
                                      components:
                                        - uesio/io.tile:
                                            uesio.styleTokens:
                                              root:
                                                - rounded-lg
                                                - overflow-hidden
                                                - bg-white
                                                - shadow-lg
                                                - max-h-80
                                                - max-w-md
                                            content:
                                              - uesio/io.box:
                                                  uesio.variant: uesio/studio.bundlelistingvisualref
                                              - uesio/io.box:
                                                  uesio.styleTokens:
                                                    root:
                                                      - p-8
                                                  components:
                                                    - uesio/io.text:
                                                        text: ${uesio/studio.app->uesio/studio.fullname}
                                                        element: span
                                                        uesio.styleTokens:
                                                          root:
                                                            - align-middle
                                                    - uesio/io.text:
                                                        uesio.variant: uesio/io.aside
                                                        text: ${uesio/studio.description}
                                                        element: p
                - uesio/io.box:
                    uesio.display:
                      - type: wireHasRecords
                        wire: bundlelisting
                    uesio.variant: uesio/io.section
                    components:
                      - uesio/io.titlebar:
                          title: History
                          uesio.variant: uesio/io.section
                      - uesio/io.table:
                          uesio.id: bundlelistinghistoryTable
                          wire: bundlelistinghistory
                          mode: READ
                          columns:
                            - field: uesio/studio.actiontype
                            - field: uesio/studio.comment
                            - field: uesio/core.createdby
                              user:
                                subtitle: $Time{uesio/core.createdat}
                            - field: uesio/core.updatedby
                              user:
                                subtitle: $Time{uesio/core.updatedat}
  panels:
    feedbackPanel:
      uesio.type: uesio/io.dialog
      title: Add a Comment
      width: 400px
      height: 500px
      components:
        - uesio/io.list:
            uesio.id: newcommentlist
            wire: newbundlelistinghistory
            mode: EDIT
            components:
              - uesio/io.field:
                  fieldId: uesio/studio.comment
      actions:
        - uesio/io.button:
            uesio.variant: uesio/io.primary
            text: $Label{uesio/io.save}
            signals:
              - signal: wire/SAVE
                wires:
                  - newbundlelistinghistory
                  - bundlelisting
              - signal: wire/RESET
                wire: newbundlelistinghistory
              - signal: wire/LOAD
                wires:
                  - bundlelistinghistory
                  - bundlelisting
              - signal: panel/TOGGLE
                panel: feedbackPanel
        - uesio/io.button:
            uesio.variant: "uesio/io.secondary"
            text: $Label{uesio/io.cancel}
            signals:
              - signal: wire/RESET
                wire: newbundlelistinghistory
              - signal: wire/CANCEL
                wire: bundlelisting
              - signal: panel/TOGGLE
                panel: feedbackPanel
      afterClose:
        - signal: wire/RESET
          wire: newbundlelistinghistory
        - signal: wire/CANCEL
          wire: bundlelisting
    newBundleListing:
      uesio.type: uesio/io.dialog
      title: Terms and Conditions
      width: 400px
      height: 500px
      components:
        - uesio/io.list:
            uesio.id: newBundleListinglist
            wire: newbundlelisting
            mode: EDIT
            components:
              - uesio/io.text:
                  uesio.variant: uesio/io.smallcontent
                  text: In order to distribute software on Uesio platform, you will need to adhere to the applicable terms in the following agreements and guidelines. Be certain to read the relevant terms carefully as you design and develop your software.
      actions:
        - uesio/io.button:
            uesio.variant: uesio/io.primary
            text: Agree
            signals:
              - signal: wire/UPDATE_RECORD
                wire: newbundlelistinghistory
                field: uesio/studio.actiontype
                valueSource: VALUE
                value: OPEN
              - signal: wire/SAVE
                wires:
                  - newbundlelisting
                  - newbundlelistinghistory
              - signal: route/RELOAD
        - uesio/io.button:
            uesio.variant: uesio/io.secondary
            text: $Label{uesio/io.cancel}
            signals:
              - signal: panel/TOGGLE
                panel: newBundleListing
