name: contact_details
definition:
  components:
    - uesio/core.view:
        view: uesio/crm.topbar
    - uesio/io.box:
        uesio.styles:
          root:
            backgroundColor: "#fafafa"
            overflow: auto
        components:
          - uesio/io.list:
              uesio.id: contactList
              wire: contacts
              mode: READ
              components:
                - uesio/io.titlebar:
                    uesio.variant: uesio/io.main
                    title: ${uesio/crm.firstname} ${uesio/crm.lastname}
                    subtitle: ${["uesio/crm.account"]["uesio/crm.name"]}
                    actions:
                      - uesio/io.group:
                          components:
                            - uesio/io.button:
                                text: Add Comment
                                uesio.variant: uesio/io.secondary
                                signals:
                                  - signal: panel/TOGGLE
                                    panel: newComment
                            - uesio/io.button:
                                signals:
                                  - signal: component/uesio/io.list/TOGGLE_MODE
                                    target: contactList
                                text: Edit
                                uesio.variant: uesio/io.secondary
                            - uesio/io.button:
                                signals:
                                  - signal: wire/SAVE
                                    wires:
                                      - contacts
                                text: Save
                                uesio.variant: uesio/io.secondary
                            - uesio/io.button:
                                signals:
                                  - signal: wire/CANCEL
                                    wire: contacts
                                text: Cancel
                                uesio.variant: uesio/io.secondary
                - uesio/io.box:
                    uesio.variant: uesio/io.section
                    uesio.styles:
                      root:
                        padding: 40px
                    components:
                      - uesio/io.grid:
                          templateColumns:
                            xs: 1fr
                            md: 1fr 1fr
                            lg: 2fr 1fr
                          columnGap: 40px
                          uesio.styles:
                            root:
                              alignItems: start
                          items:
                            - uesio/io.grid:
                                templateColumns:
                                  xs: 1fr
                                  md: 1fr 1fr
                                  lg: 1fr 1fr 1fr 1fr
                                columnGap: 10px
                                items:
                                  - uesio/io.field:
                                      fieldId: uesio/core.id
                                  - uesio/io.field:
                                      fieldId: uesio/crm.firstname
                                  - uesio/io.field:
                                      fieldId: uesio/crm.lastname
                                  - uesio/io.field:
                                      fieldId: uesio/crm.gender
                                  - uesio/io.field:
                                      fieldId: uesio/crm.account
                                  - uesio/io.field:
                                      fieldId: uesio/crm.birthdate
                                  - uesio/io.field:
                                      fieldId: uesio/core.updatedat
                                  - uesio/io.field:
                                      fieldId: uesio/core.createdat
                            - uesio/io.deck:
                                wire: comments
                                uesio.id: commentslist
                                mode: READ
                                components:
                                  - uesio/io.tile:
                                      content:
                                        - uesio/io.field:
                                            fieldId: uesio/core.owner
                                            labelPosition: none
                                        - uesio/io.box:
                                            uesio.styles:
                                              root:
                                                borderRadius: 8px
                                                backgroundColor: "#f5f5f5"
                                                padding: 10px 20px
                                            components:
                                              - uesio/io.field:
                                                  fieldId: uesio/crm.comment_body
                                                  displayAs: MARKDOWN
                                                  labelPosition: none
  wires:
    contacts:
      collection: uesio/crm.contact
      conditions:
        - field: uesio/core.id
          param: recordid
          valueSource: PARAM
      fields:
        uesio/crm.account:
          fields:
            uesio/crm.name:
        uesio/crm.birthdate:
        uesio/crm.firstname:
        uesio/crm.gender:
        uesio/core.id:
        uesio/crm.lastname:
        uesio/core.updatedat:
        uesio/core.createdat:
    comments:
      collection: uesio/crm.comment
      conditions:
        - field: uesio/crm.related_contact
          param: recordid
          valueSource: PARAM
      fields:
        uesio/crm.comment_body:
        uesio/core.owner:
    newcomment:
      collection: uesio/crm.comment
      fields:
        uesio/crm.comment_body:
      init:
        query: false
        create: true
      defaults:
        - field: uesio/crm.related_contact
          valueSource: LOOKUP
          lookupWire: contacts
          lookupField: uesio/core.id
  params:
    recordid:
      type: RECORD
      required: true
      collection: uesio/crm.contact
  panels:
    newComment:
      uesio.type: uesio/io.dialog
      title: Add a Comment
      width: 400px
      height: 500px
      components:
        - uesio/io.list:
            uesio.id: newcommentlist
            wire: newcomment
            mode: EDIT
            components:
              - uesio/io.field:
                  fieldId: uesio/crm.comment_body
      actions:
        - uesio/io.button:
            uesio.variant: uesio/io.primary
            text: "Save"
            signals:
              - signal: wire/SAVE
                wires:
                  - newcomment
              - signal: wire/RESET
                wire: newcomment
              - signal: wire/LOAD
                wires:
                  - comments
              - signal: "panel/TOGGLE"
                panel: newComment
        - uesio/io.button:
            uesio.variant: "uesio/io.secondary"
            text: "Cancel"
            signals:
              - signal: wire/RESET
                wire: newcomment
              - signal: "panel/TOGGLE"
                panel: "newComment"
