name: lead_details
definition:
  components:
    - uesio/core.view:
        view: uesio/crm.topbar
    - uesio/io.list:
        id: leadList
        wire: leads
        mode: READ
        components:
          - uesio/io.titlebar:
              uesio.variant: uesio/io.main
              title: ${uesio/crm.firstname} ${uesio/crm.lastname}
              actions:
                - uesio/io.group:
                    components:
                      - uesio/io.button:
                          signals:
                            - signal: wire/EMPTY
                              wire: accs
                            - signal: wire/EMPTY
                              wire: contact
                            - signal: panel/OPEN
                              panel: convertlead
                          text: Convert
                          uesio.variant: uesio/io.secondary
                          uesio.display:
                            - type: wireHasNoChanges
                              operator: EQUALS
                              wire: leads
                            - type: wireHasNoChanges
                              operator: EQUALS
                              wire: tasks
                          icon: add_road
                      - uesio/io.button:
                          signals:
                            - signal: wire/SAVE
                              wires:
                                - leads
                                - tasks
                                - events
                          text: Save
                          uesio.variant: uesio/io.primary
                          icon: save
                          uesio.display: []
                      - uesio/io.button:
                          signals:
                            - signal: wire/CANCEL
                              wire: leads
                            - signal: wire/CANCEL
                              wire: tasks
                            - signal: wire/CANCEL
                              wire: events
                          text: Cancel
                          uesio.variant: uesio/io.secondary
                          icon: cancel
                          uesio.display: []
                    uesio.display: []
          - uesio/io.box:
              uesio.variant: ""
              uesio.styles:
                root:
                  padding: 40px
              components:
                - uesio/io.grid:
                    templateColumns: 1fr 1fr 1fr 1fr
                    columnGap: 10px
                    items:
                      - uesio/io.list:
                          mode: EDIT
                          wire: leads
                          components:
                            - uesio/io.field:
                                fieldId: uesio/crm.account
                                displayAs: TEXT
                            - uesio/io.field:
                                fieldId: uesio/crm.title
                            - uesio/io.field:
                                fieldId: uesio/crm.firstname
                            - uesio/io.field:
                                fieldId: uesio/crm.lastname
                            - uesio/io.field:
                                fieldId: uesio/crm.email
                            - uesio/io.field:
                                fieldId: uesio/crm.description
                            - uesio/io.field:
                                fieldId: uesio/crm.annual_revenue
                            - uesio/io.field:
                                fieldId: uesio/crm.industry
                            - uesio/io.field:
                                fieldId: uesio/crm.mailing_street
                            - uesio/io.field:
                                fieldId: uesio/crm.mailing_city
                            - uesio/io.field:
                                fieldId: uesio/crm.mailing_country
                            - uesio/io.field:
                                fieldId: uesio/crm.mailing_state_province
                    templateRows: 1fr
                - uesio/io.grid:
                    templateColumns: "200px 200px 200px 200px 200px "
                    columnGap: 10px
                    items:
                      - uesio/io.field:
                          fieldId: uesio/core.createdat
                      - uesio/io.field:
                          fieldId: uesio/core.createdby
                      - uesio/io.field:
                          fieldId: uesio/core.updatedat
                      - uesio/io.field:
                          fieldId: uesio/core.updatedby
                      - uesio/io.field:
                          fieldId: uesio/core.owner
                    templateRows: 1fr
                    uesio.styles:
                      root:
                        border: 1px solid
                        padding: 5px
                        color: lightgrey
                - uesio/io.box:
                    components:
                      - uesio/io.tabs:
                          tabs:
                            - label: TASKS
                              id: "0"
                              components:
                                - uesio/io.group:
                                    columnGap: 10px
                                    components:
                                      - uesio/io.button:
                                          text: NEW TASK
                                          icon: bolt
                                          uesio.variant: uesio/io.primary
                                          signals:
                                            - signal: wire/CREATE_RECORD
                                              wire: tasks
                                    alignItems: end
                                    justifyContent: end
                                    uesio.styles:
                                      root:
                                        padding: 10px
                                - uesio/io.table:
                                    wire: tasks
                                    columns:
                                      - field: uesio/crm.name
                                      - field: uesio/crm.subject
                                      - field: uesio/crm.task_type
                                      - field: uesio/crm.due_date_time
                                    mode: EDIT
                            - label: EVENTS
                              id: "1"
                              components:
                                - uesio/io.group:
                                    columnGap: 10px
                                    components:
                                      - uesio/io.button:
                                          text: New Event
                                          icon: bolt
                                          uesio.variant: uesio/io.secondary
                                          signals:
                                            - signal: wire/CREATE_RECORD
                                              wire: events
                                    justifyContent: end
                                    uesio.styles:
                                      root:
                                        padding: 20px
                                - uesio/io.table:
                                    wire: events
                                    mode: EDIT
                                    pagesize: 10
                                    columns:
                                      - field: uesio/crm.start_date_time
                                      - field: uesio/crm.end_date_time
                                      - field: uesio/crm.name
                                      - field: uesio/crm.event_type
                                      - field: uesio/crm.subject
                                      - field: uesio/crm.venue
                                      - field: uesio/crm.remind_at
                                      - field: uesio/crm.send_notification_email
                                        displayAs: RADIO
                          uesio.variant: uesio/io.default
                    uesio.styles:
                      root:
                        paddingTop: 40px
  wires:
    leads:
      collection: uesio/crm.lead
      conditions:
        - field: uesio/core.id
          param: recordid
          valueSource: PARAM
      fields:
        uesio/crm.firstname:
        uesio/core.id:
        uesio/crm.lastname:
        uesio/core.updatedat:
        uesio/core.createdat:
        uesio/crm.account: {}
        uesio/crm.annual_revenue: {}
        uesio/crm.contact_image: {}
        uesio/crm.description: {}
        uesio/crm.email: {}
        uesio/crm.has_opt_out_email: {}
        uesio/crm.industry: {}
        uesio/crm.mailing_city: {}
        uesio/crm.mailing_country: {}
        uesio/crm.mailing_state_province: {}
        uesio/crm.mailing_street: {}
        uesio/crm.mailing_zip_postal: {}
        uesio/crm.no_employees: {}
        uesio/crm.phone: {}
        uesio/crm.phone_business: {}
        uesio/crm.phone_mobile: {}
        uesio/crm.rating: {}
        uesio/crm.status: {}
        uesio/crm.title: {}
        uesio/crm.website: {}
        uesio/core.createdby: {}
        uesio/core.owner: {}
        uesio/core.updatedby: {}
        uesio/crm.converted_date: {}
        uesio/crm.converted_opportunity: {}
        uesio/crm.converted_to_account: {}
        uesio/crm.converted_to_contact: {}
        uesio/crm.is_converted: {}
    tasks:
      batchsize: 100
      collection: uesio/crm.task
      defaults:
        - field: uesio/crm.related_lead
          valueSource: LOOKUP
          lookupWire: leads
          lookupField: uesio/core.id
      fields:
        uesio/core.createdat: {}
        uesio/core.createdby: {}
        uesio/crm.name: {}
        uesio/crm.description: {}
        uesio/crm.due_date_time: {}
        uesio/crm.priority: {}
        uesio/crm.recurring_activity: {}
        uesio/crm.related_lead: {}
        uesio/crm.remind_at: {}
        uesio/crm.send_notification_email: {}
        uesio/crm.status: {}
        uesio/crm.subject: {}
        uesio/crm.task_type: {}
      conditions:
        - id: leadid
          field: uesio/crm.related_lead
          operator: EQ
          valueSource: PARAM
          param: recordid
    events:
      batchsize: 10
      collection: uesio/crm.event
      defaults:
        - field: uesio/crm.related_lead
          valueSource: LOOKUP
          lookupWire: leads
          lookupField: uesio/core.id
      fields:
        uesio/crm.start_date_time: {}
        uesio/crm.end_date_time: {}
        uesio/crm.name: {}
        uesio/crm.related_lead: {}
        uesio/crm.remind_at: {}
        uesio/crm.send_notification_email: {}
        uesio/crm.subject: {}
        uesio/crm.venue: {}
        uesio/crm.description: {}
        uesio/crm.recurring_activity: {}
        uesio/crm.event_type: {}
      conditions:
        - id: leadeventid
          field: uesio/crm.related_lead
          operator: EQ
          valueSource: PARAM
          param: recordid
    accs:
      batchsize: 200
      collection: uesio/crm.account
      fields:
        uesio/crm.name: {}
        uesio/crm.shipping_city: {}
        uesio/crm.description: {}
    contact:
      batchsize: 200
      collection: uesio/crm.contact
      fields:
        uesio/crm.firstname: {}
        uesio/crm.lastname: {}
        uesio/crm.account: {}
  params:
    recordid:
      type: RECORD
      required: true
      collection: uesio/crm.lead
  panels:
    convertlead:
      uesio.type: uesio/io.dialog
      components:
        - uesio/io.list:
            mode: READ
            wire: leads
            components:
              - uesio/io.button:
                  text: Convert
                  icon: bolt
                  uesio.variant: uesio/io.secondary
                  signals:
                    - signal: wire/CREATE_RECORD
                      wire: accs
                    - signal: wire/UPDATE_RECORD
                      wire: accs
                      field: uesio/crm.name
                      value: ${uesio.crm.account} XYZ
                    - signal: wire/UPDATE_RECORD
                      wire: accs
                      field: uesio/crm.shipping_city
                      value: ${uesio.crm.mailing_city} CHATTANOOGA
                    - signal: wire/UPDATE_RECORD
                      wire: accs
                      field: uesio/crm.description
                      value: converted
                    - signal: wire/SAVE
                      wires:
                        - accs
                    - signal: wire/CREATE_RECORD
                      wire: contact
                    - signal: wire/UPDATE_RECORD
                      wire: contact
                      field: uesio/crm.firstname
                      value: ${uesio.crm.firstname}
                    - signal: wire/UPDATE_RECORD
                      wire: contact
                      field: uesio/crm.account
                      value: ${uesio.crm.lastname}
                    - signal: wire/UPDATE_RECORD
                      wire: contact
                      field: uesio/crm.account
                      value: ${uesio.crm.account}
                    - signal: wire/SAVE
                      wires:
                        - contact
                    - signal: wire/UPDATE_RECORD
                      wire: leads
                      field: uesio/crm.is_converted
                      value: "True"
                    - signal: wire/UPDATE_RECORD
                      wire: leads
                      field: uesio/crm.converted_to_contact
                      value: ${uesio.crm.contact}
                    - signal: wire/UPDATE_RECORD
                      wire: leads
                      field: uesio/crm.converted_to_account
                      value: ${uesio.crm.name}
                    - signal: wire/SAVE
                      wires:
                        - leads
        - uesio/io.table:
            wire: leads
            columns:
              - field: uesio/crm.firstname
              - field: uesio/crm.lastname
              - field: uesio/crm.account
              - field: uesio/crm.is_converted
            mode: EDIT
        - uesio/io.table:
            wire: accs
            columns:
              - field: uesio/crm.name
              - field: uesio/crm.shipping_city
            mode: EDIT
        - uesio/io.table:
            wire: contact
            columns:
              - field: uesio/crm.firstname
              - field: uesio/crm.lastname
              - field: uesio/crm.account
      width: 80%
      height: 80%
      title: New Panel
