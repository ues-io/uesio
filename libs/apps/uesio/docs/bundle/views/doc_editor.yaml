name: doc_editor
definition:
  components:
    - uesio/io.titlebar:
        uesio.variant: uesio/io.main
        title: Admin panel
        subtitle: Is there a doc in the room?!
    - uesio/io.grid:
        uesio.variant: uesio/docs.mainlayout
        uesio.context:
          wire: articles
        items:
          - uesio/io.griditem:
              uesio.variant: uesio/docs.localnav
              components:
                - uesio/io.button:
                    icon: arrow_back
                    signals:
                      - signal: route/NAVIGATE
                        path: admin
                    uesio.styles:
                      root:
                        background: " #32e896"
                        border-radius: 1.5em
                        width: 3em
                        margin-right: 1em
                # ARTICLES
                # TODO list tracks and corresponding articles
                - uesio/io.text:
                    text: Developer track
                    element: h3
                - uesio/io.list:
                    wire: articles
                    id: articleList
                    mode: EDIT
                    components:
                      # Active
                      - uesio/io.tile:
                          signals:
                            - signal: "route/NAVIGATE"
                              path: "admin/doc/${uesio/core.id}"
                          uesio.styles:
                            root:
                              marginBottom: 1em
                              fontWeight: 700
                          content:
                            - uesio/io.text:
                                uesio.display:
                                  - value: $Param{recordid}
                                    field: uesio/core.id
                                    type: fieldValue
                                    operator: EQUALS
                                text: ${uesio/cms.name}
                            # Non active
                            - uesio/io.text:
                                uesio.display:
                                  - value: $Param{recordid}
                                    field: uesio/core.id
                                    operator: NOT_EQUALS
                                text: ${uesio/cms.name}
                                uesio.styles:
                                  root:
                                    opacity: 0.6
          - uesio/io.griditem:
              components:
                # New article
                - uesio/io.list:
                    wire: article
                    id: articleList
                    mode: EDIT
                    components:
                      # Slug + order
                      - uesio/io.grid:
                          templateColumns: 1fr 1fr
                          columnGap: 10px
                          items:
                            - uesio/io.field:
                                fieldId: uesio/cms.slug
                            - uesio/io.field:
                                fieldId: uesio/docs.order
                            - uesio/io.field:
                                fieldId: uesio/docs.track
                                reference:
                                  template: ${uesio/docs.name}
                                  searchFields:
                                    - uesio/docs.name
                                  returnFields:
                                    - uesio/docs.name
                            - uesio/io.button:
                                icon: visibility
                                uesio.variant: uesio/docs.icon
                                signals:
                                  - signal: "route/NAVIGATE"
                                    path: "docs/${uesio/docs.track->uesio/docs.name}/${uesio/cms.slug}"

                      # Name
                      - uesio/io.field:
                          fieldId: uesio/cms.name

                      # Track

                      - uesio/io.box:
                          uesio.styles:
                            root:
                              display: flex
                              gap: 15px
                              "div":
                                flex: 1
                          components:
                            - uesio/io.field:
                                fieldId: uesio/cms.content
                                displayAs: MARKDOWN
                                id: mdcontent
                                labelPosition: none
                            - uesio/io.field:
                                labelPosition: none
                                id: mdcontent
                                uesio.context:
                                  fieldMode: READ
                                fieldId: uesio/cms.content
                                displayAs: MARKDOWN

                      - uesio/io.group:
                          uesio.styles:
                            root:
                              justify-content: flex-end
                          components:
                            - uesio/io.button:
                                uesio.variant: uesio/io.secondary
                                text: Cancel
                                signals:
                                  - signal: wire/CANCEL
                                    wire: article
                            - uesio/io.button:
                                uesio.variant: uesio/io.primary
                                text: Save
                                signals:
                                  - signal: wire/SAVE
                                    wires:
                                      - article
                                  - signal: component/uesio/io.field/SAVE_FILE
                                    target: mdcontent

  wires:
    article:
      collection: uesio/cms.article
      fields:
        uesio/core.createdat:
        uesio/core.id:
        uesio/docs.track:
          fields:
            uesio/core.id:
            uesio/docs.name:
        uesio/cms.content:
        uesio/cms.slug:
        uesio/cms.name:
        uesio/docs.order:
      conditions:
        - field: uesio/core.id
          param: recordid
          valueSource: PARAM

    articles:
      collection: uesio/cms.article
      order:
        - field: uesio/docs.order
      fields:
        uesio/core.createdat:
        uesio/core.id:
        uesio/docs.order:
        uesio/docs.track:
          fields:
            uesio/core.id:
            uesio/docs.name:
        uesio/cms.content:
        uesio/cms.name:
