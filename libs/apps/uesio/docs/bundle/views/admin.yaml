name: admin
definition:
  components:
    - uesio/io.titlebar:
        uesio.variant: uesio/io.main
        title: Admin panel
        subtitle: Is there a doc in the room?!

    # variant: Admin section
    - uesio/io.grid:
        uesio.variant: uesio/docs.mainlayout
        items:
          - uesio/io.griditem:
              uesio.styles:
                root:
                  gridColumnStart: col1-start
                  gridColumnEnd: col2-end
              components:
                - uesio/io.titlebar:
                    uesio.variant: uesio/io.main
                    title: Tracks
                    actions:
                      - uesio/io.group:
                          components:
                            - uesio/io.button:
                                text: Add a track
                                uesio.variant: uesio/io.secondary
                                signals:
                                  - signal: wire/CREATE_RECORD
                                    wire: newtrack
                            - uesio/io.button:
                                text: Save
                                uesio.variant: uesio/io.primary
                                signals:
                                  - signal: wire/SAVE
                                    wires:
                                      - tracks
                                  - signal: wire/CANCEL
                                    wire: newtrack
                                  - signal: wire/CANCEL
                                    wire: tracks

                - uesio/io.box:
                    uesio.styles:
                      root:
                        display: flex
                        gap: 15px
                        flexFlow: column
                    components:
                      # Track list
                      - uesio/io.list:
                          wire: tracks
                          id: trackList
                          components:
                            - uesio/io.box:
                                uesio.styles:
                                  root:
                                    border: "1px solid #000"
                                    flex: 1
                                    padding: 15px
                                    display: flex
                                components:
                                  - uesio/io.button:
                                      icon: visibility
                                      uesio.variant: uesio/docs.icon
                                      signals:
                                        - signal: "route/NAVIGATE"
                                          path: "docs/${uesio/docs.name}"

                                  - uesio/io.button:
                                      icon: edit
                                      uesio.variant: uesio/docs.icon
                                      signals:
                                        - signal: "route/NAVIGATE"
                                          path: "admin/track/${uesio/core.id}"

                                  - uesio/io.box:
                                      components:
                                        - uesio/io.text:
                                            text: ${uesio/docs.name}
                                            element: p
                                            uesio.styles:
                                              root:
                                                margin: 0 0 0.25em 0

                                  - uesio/io.button:
                                      icon: delete
                                      uesio.variant: uesio/docs.icon
                                      uesio.styles:
                                        root:
                                          margin-left: auto
                                          backgroundColor: none
                                          # backgroundColor: "#c1f2dc"
                                          opacity: 0.6
                                          "&:hover":
                                            opacity: 1
                                            backgroundColor: $Theme{color.primary}
                                            # backgroundColor: none
                                      signals:
                                        - signal: panel/TOGGLE
                                          panel: deleteArticle

                      # New track
                      - uesio/io.list:
                          wire: newtrack
                          id: newTrackList
                          mode: EDIT
                          components:
                            - uesio/io.box:
                                uesio.styles:
                                  root:
                                    border: "1px solid #000"
                                    flex: 50%
                                    padding: 15px
                                components:
                                  - uesio/io.field:
                                      fieldId: uesio/docs.name
                                  - uesio/io.group:
                                      components:
                                        - uesio/io.button:
                                            uesio.variant: uesio/io.secondary
                                            text: Cancel
                                            signals:
                                              - signal: wire/CANCEL
                                                wire: newtrack
                                        - uesio/io.button:
                                            uesio.variant: uesio/io.primary
                                            text: Save
                                            signals:
                                              - signal: wire/SAVE
                                                wires:
                                                  - newtrack
                                              - signal: wire/EMPTY
                                                wire: newtrack
                                              - signal: wire/LOAD
                                                wires:
                                                  - tracks

                - uesio/io.box:
                    components:
                      - uesio/io.titlebar:
                          uesio.variant: uesio/io.main
                          title: Docs
                          actions:
                            - uesio/io.group:
                                components:
                                  - uesio/io.button:
                                      text: Add a doc
                                      uesio.variant: uesio/io.secondary
                                      signals:
                                        - signal: wire/CREATE_RECORD
                                          wire: newarticle
                      - uesio/io.searchbox:
                          wire: articles
                      - uesio/io.box:
                          uesio.styles:
                            root:
                              display: flex
                              gap: 15px
                              flexFlow: column
                          components:
                            # New article
                            - uesio/io.list:
                                wire: newarticle
                                id: newArticleList
                                mode: EDIT
                                components:
                                  - uesio/io.box:
                                      uesio.styles:
                                        root:
                                          border: "1px solid #000"
                                          flex: 50%
                                          padding: 15px
                                      components:
                                        - uesio/io.field:
                                            fieldId: uesio/cms.name
                                        - uesio/io.field:
                                            fieldId: uesio/docs.track
                                            reference:
                                              template: ${uesio/docs.name}
                                              searchFields:
                                                - uesio/docs.name
                                              returnFields:
                                                - uesio/docs.name
                                        - uesio/io.group:
                                            components:
                                              - uesio/io.button:
                                                  uesio.variant: uesio/io.secondary
                                                  text: Cancel
                                                  signals:
                                                    - signal: wire/CANCEL
                                                      wire: newarticle
                                              - uesio/io.button:
                                                  uesio.variant: uesio/io.primary
                                                  text: Save
                                                  signals:
                                                    - signal: wire/SAVE
                                                      wires:
                                                        - newarticle
                                                    - signal: wire/EMPTY
                                                      wire: newarticle
                                                    - signal: wire/LOAD
                                                      wires:
                                                        - articles

                            # Articles list
                            - uesio/io.list:
                                wire: articles
                                id: articleList
                                components:
                                  - uesio/io.box:
                                      uesio.styles:
                                        root:
                                          border: "1px solid #000"
                                          flex: 1
                                          padding: 15px
                                          display: flex
                                      components:
                                        - uesio/io.button:
                                            icon: visibility
                                            uesio.variant: uesio/docs.icon
                                            signals:
                                              - signal: "route/NAVIGATE"
                                                path: "docs/${uesio/docs.track->uesio/docs.name}/${uesio/cms.slug}"

                                        - uesio/io.button:
                                            icon: edit
                                            uesio.variant: uesio/docs.icon
                                            signals:
                                              - signal: "route/NAVIGATE"
                                                path: "admin/doc/${uesio/core.id}"

                                        - uesio/io.box:
                                            components:
                                              - uesio/io.text:
                                                  text: ${uesio/cms.name}
                                                  element: p
                                                  uesio.styles:
                                                    root:
                                                      margin: 0 0 0.25em 0
                                              - uesio/io.text:
                                                  text: ${uesio/docs.track->uesio/docs.name}
                                                  element: p
                                                  uesio.styles:
                                                    root:
                                                      margin: 0
                                                      fontSize: 0.8em
                                        - uesio/io.button:
                                            icon: delete
                                            uesio.variant: uesio/docs.icon
                                            uesio.styles:
                                              root:
                                                margin-left: auto
                                                backgroundColor: none
                                                # backgroundColor: "#c1f2dc"
                                                opacity: 0.6
                                                "&:hover":
                                                  opacity: 1
                                                  backgroundColor: $Theme{color.primary}
                                                  # backgroundColor: none
                                            signals:
                                              - signal: panel/TOGGLE
                                                panel: deleteArticle

  panels:
    deleteArticle:
      uesio.type: uesio/io.dialog
      title: Delete Article
      width: 400px
      height: 300px
      components:
        - uesio/io.text:
            text: Are you sure you want to delete this article?
      actions:
        - uesio/io.button:
            text: Delete
            uesio.variant: uesio/io.secondary
            signals:
              - signal: wire/MARK_FOR_DELETE
              - signal: wire/SAVE
                wires:
                  - "articles"
        - uesio/io.button:
            text: Cancel
            uesio.variant: uesio/io.primary
            signals:
              - signal: panel/TOGGLE
                panel: deleteArticle

  wires:
    # Articles
    newarticle:
      collection: uesio/cms.article
      init:
        query: false
      fields:
        uesio/core.createdat:
        uesio/core.id:
        uesio/docs.track:
          fields:
            uesio/core.id:
            uesio/docs.name:
        uesio/cms.content:
        uesio/cms.name:

    articles:
      collection: uesio/cms.article
      order:
        - field: uesio/core.updatedat
          desc: true
      fields:
        uesio/core.updatedat:
        uesio/core.id:
        uesio/docs.order:
        uesio/docs.track:
          fields:
            uesio/core.id:
            uesio/docs.name:
        uesio/cms.content:
        uesio/cms.name:
        uesio/cms.slug:

    # Tracks
    tracks:
      collection: uesio/docs.track
      fields:
        uesio/core.id:
        uesio/docs.name:
        uesio/docs.slug:
        uesio/docs.description:
        uesio/docs.doc:
          fields:
            uesio/cms.name:
    newtrack:
      collection: uesio/docs.track
      init:
        query: false
      fields:
        uesio/core.id:
        uesio/docs.name:
